"use client"

import * as React from "react"
import Link from "next/link"
import { usePathname } from "next/navigation"
import { signOut } from "next-auth/react"
import { Ticket, ScanLine, LogOut } from "lucide-react"

import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarHeader,
  SidebarMenu,
  SidebarMenuItem,
  SidebarProvider,
  SidebarInset,
  SidebarTrigger,
  SidebarGroup,
  SidebarGroupLabel,
  SidebarGroupContent,
} from "@workspace/ui/components/sidebar"
import { Separator } from "@workspace/ui/components/separator"
import {
  TooltipProvider,
} from "@workspace/ui/components/tooltip"

// SK Events Logo Component (white version)
function SkEventsLogo({ className }: { className?: string }) {
  return (
    <svg
      viewBox="0 0 460 119"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      className={className}
    >
      <path d="M6.55508 117L12.7411 79.7382H39.5959L38.2131 87.8892H21.4744L20.4555 94.2936H35.8114L34.4287 102.445H19.0727L18.0539 108.849H34.7198L33.337 117H6.55508ZM52.24 79.7382L55.5149 106.011H55.806L67.8142 79.7382H79.2402L60.7549 117H46.9272L40.814 79.7382H52.24ZM74.0813 117L80.2673 79.7382H107.122L105.739 87.8892H89.0005L87.9817 94.2936H103.338L101.955 102.445H86.5989L85.58 108.849H102.246L100.863 117H74.0813ZM141.818 79.7382L135.632 117H127.189L117.001 97.423H116.782L113.507 117H103.391L109.577 79.7382H118.165L128.208 99.2424H128.499L131.702 79.7382H141.818ZM141.639 87.8892L143.022 79.7382H175.408L174.025 87.8892H162.817L158.014 117H148.044L152.847 87.8892H141.639ZM194.775 91.3825C194.884 90.1817 194.593 89.2416 193.901 88.5624C193.21 87.871 192.046 87.5253 190.408 87.5253C189.365 87.5253 188.492 87.6466 187.788 87.8892C187.097 88.1318 186.557 88.4653 186.169 88.8899C185.793 89.3144 185.556 89.8056 185.459 90.3636C185.35 90.8003 185.356 91.2005 185.477 91.5644C185.611 91.9162 185.859 92.2376 186.223 92.5287C186.599 92.8198 187.091 93.0806 187.697 93.3111C188.316 93.5415 189.05 93.7477 189.899 93.9297L192.81 94.5847C194.799 95.0213 196.467 95.5975 197.813 96.3131C199.172 97.0166 200.239 97.8536 201.015 98.8239C201.792 99.7943 202.301 100.88 202.544 102.081C202.798 103.282 202.804 104.592 202.562 106.011C202.149 108.461 201.197 110.535 199.705 112.233C198.213 113.931 196.267 115.223 193.865 116.108C191.463 116.994 188.686 117.437 185.532 117.437C182.306 117.437 179.564 116.958 177.308 115.999C175.064 115.029 173.439 113.549 172.432 111.56C171.438 109.559 171.195 107.005 171.704 103.9H181.311C181.165 105.04 181.287 105.999 181.675 106.775C182.063 107.551 182.688 108.139 183.549 108.54C184.41 108.94 185.483 109.14 186.769 109.14C187.861 109.14 188.795 109.007 189.571 108.74C190.347 108.473 190.96 108.103 191.409 107.63C191.858 107.157 192.13 106.617 192.227 106.011C192.325 105.453 192.227 104.955 191.936 104.519C191.645 104.082 191.118 103.688 190.353 103.336C189.589 102.984 188.54 102.663 187.206 102.372L183.64 101.571C180.474 100.843 178.084 99.6427 176.471 97.9688C174.858 96.2949 174.288 94.0025 174.761 91.0914C175.149 88.714 176.126 86.6398 177.69 84.8689C179.267 83.0859 181.268 81.7031 183.694 80.7207C186.132 79.726 188.831 79.2287 191.791 79.2287C194.799 79.2287 197.316 79.7321 199.341 80.7388C201.379 81.7456 202.841 83.1587 203.726 84.9781C204.624 86.7975 204.866 88.9323 204.454 91.3825H194.775Z" fill="currentColor"/>
      <path d="M19.2139 0.910721C19.2139 1.39442 20.0603 4.17569 21.1487 7.31974C23.0835 12.6404 23.0835 13.366 19.9394 27.877C18.1255 36.0999 17.0372 43.1135 17.2791 43.4763C17.6418 43.7182 19.3348 42.8717 21.0277 41.5415C25.1392 38.2765 35.1759 35.0116 39.4083 35.4953C43.157 35.858 43.5198 38.0347 40.9803 47.104L39.6502 52.1829H33.6039H27.6786L28.4041 47.104L29.2506 42.0252L25.1392 44.9274C19.8185 48.6761 5.91211 61.9778 5.91211 63.308C5.91211 63.7917 14.6187 64.2754 25.381 64.2754H44.8499L48.1149 60.8895C50.7753 58.2291 51.9845 54.8432 54.7658 41.5415C56.5797 32.5931 57.7889 24.612 57.4261 23.5237C56.4587 20.9843 45.2127 22.4354 35.6596 26.305L28.4041 29.2072L31.0645 26.4259C32.5156 24.8539 33.7248 23.1609 33.7248 22.4354C33.7248 21.8307 34.3295 19.2913 35.055 16.7519C36.2643 12.1567 36.3852 12.1567 41.9477 12.5195C47.6312 12.8823 47.6312 12.8823 47.2684 16.8728L47.0266 20.8633L51.5008 17.5984C62.1422 9.73824 63.9561 6.35234 59.3609 2.2409C57.4261 0.547946 54.1612 0.185171 38.1991 0.185171C27.7995 0.185171 19.2139 0.547946 19.2139 0.910721Z" fill="currentColor"/>
      <path d="M73.991 2.48274C71.9352 3.81292 69.8795 5.86864 69.5167 7.07789C68.0656 11.794 59.1172 55.3269 59.1172 57.7454C59.1172 62.9452 62.5031 64.2754 76.5304 64.2754C89.1066 64.2754 89.5903 64.1545 92.8552 60.8895C96.483 57.3827 96.6039 56.899 102.65 27.9979C106.883 7.44066 107.003 4.90124 104.101 2.24089C100.594 -0.903157 79.3117 -0.661307 73.991 2.48274ZM92.9762 13.8497C92.9762 15.5426 85.9625 48.4342 85.1161 50.6109C84.8742 51.5783 82.3348 52.1829 79.0698 52.1829C72.4189 52.1829 72.5399 52.7875 76.6513 32.5931C80.8837 12.2777 80.8837 12.2777 87.5345 12.2777C91.1623 12.2777 92.9762 12.7614 92.9762 13.8497Z" fill="currentColor"/>
      <path d="M116.677 2.2409C115.589 6.11049 105.068 56.4153 105.068 57.9873C105.068 58.7128 106.157 60.5267 107.487 61.8569C109.543 63.9126 111.477 64.2754 122.602 64.2754C134.695 64.2754 135.421 64.1545 138.927 60.8895C142.313 57.8664 142.918 55.8106 147.997 31.6257C151.02 17.3565 153.68 4.41754 154.043 2.84552C154.648 0.427021 154.285 0.185171 149.327 0.185171C146.425 0.185171 143.522 0.910721 142.797 1.7572C142.071 2.60367 139.774 11.4312 137.718 21.468C135.662 31.3838 133.365 42.2671 132.518 45.532L131.067 51.5783L124.9 51.941L118.733 52.3038L123.933 27.7561C126.835 14.2125 129.011 2.48275 128.649 1.63627C128.286 0.789796 125.988 0.185171 122.723 0.185171C118.612 0.185171 117.161 0.668871 116.677 2.2409Z" fill="currentColor"/>
      <path d="M162.508 2.84653C161.419 7.5626 149.811 63.0671 149.811 63.6718C149.811 65.0019 160.452 64.1555 161.661 62.7044C162.387 61.9788 164.442 54.1187 166.256 45.2912C168.191 36.4637 169.763 29.45 170.005 29.5709C170.126 29.8128 171.335 36.9474 172.665 45.533C175.326 63.0671 176.293 64.6392 184.274 64.0345L189.111 63.6718L195.399 34.6498C198.906 18.6877 201.687 4.41855 201.687 2.84653C201.808 0.307103 201.325 0.0652533 196.125 0.428028L190.32 0.790803L186.572 18.3249C184.395 27.9989 182.46 35.0126 182.098 34.0452C181.735 33.0778 180.646 26.0641 179.679 18.5668C177.502 2.36283 176.172 0.186178 168.433 0.186178C163.959 0.186178 163.112 0.548953 162.508 2.84653Z" fill="currentColor"/>
      <path d="M210.877 1.63711C210.03 4.5393 198.18 61.2531 198.18 62.8251C198.18 63.9134 202.17 64.2762 213.9 64.2762C236.271 64.2762 235.304 65.3645 242.196 31.8683L247.517 6.23225L245.099 3.20913C242.801 0.306931 242.317 0.186006 227.081 0.186006C215.593 0.186006 211.24 0.548781 210.877 1.63711ZM233.248 13.8505C233.248 15.5435 226.234 48.4351 225.388 50.6117C225.025 51.5791 222.607 52.1837 218.979 52.1837H213.053L215.714 39.1238C217.286 31.9893 219.1 23.0408 219.946 19.1712L221.276 12.2785H227.323C231.313 12.2785 233.248 12.7622 233.248 13.8505Z" fill="currentColor"/>
      <path d="M256.587 1.63676C260.577 12.7619 260.577 11.4317 256.466 31.9889C253.201 47.7092 251.75 52.4252 249.21 55.6902C241.713 65.0014 241.592 64.2759 251.75 64.2759C257.554 64.2759 261.182 63.7922 261.907 62.7038C262.633 61.9783 264.205 56.1739 265.414 49.8858C266.744 43.5977 268.437 37.6724 269.284 36.8259C270.13 35.9794 273.032 35.2539 275.693 35.2539C281.376 35.2539 281.376 35.3748 277.99 49.523C274.484 64.2759 274.484 64.2759 281.376 64.2759H287.302L289.841 51.8206C293.106 36.3422 293.106 35.012 290.083 32.2308C286.818 29.3286 287.06 27.5147 290.808 25.5799C294.678 23.4032 296.613 19.6546 298.548 10.4643C299.394 6.47375 300.361 2.60416 300.603 1.63676C301.087 0.427508 299.757 0.185658 294.799 0.427508L288.269 0.790282L285.971 11.9154C283.795 22.6777 283.553 23.0405 279.925 23.8869C277.869 24.2497 274.121 25.7008 271.702 26.9101C265.777 29.9332 264.93 29.8123 268.195 26.3054C270.977 23.2823 276.297 3.57156 274.967 1.27398C273.758 -0.539892 255.861 -0.177117 256.587 1.63676Z" fill="currentColor"/>
      <path d="M308.826 2.84653C307.738 7.5626 296.129 63.0671 296.129 63.6718C296.129 65.0019 306.77 64.1555 307.98 62.7044C309.672 60.7696 321.765 3.693 320.919 1.7582C320.677 0.790803 318.137 0.186178 314.993 0.186178C310.277 0.186178 309.431 0.548953 308.826 2.84653Z" fill="currentColor"/>
      <path d="M332.653 2.11847C331.202 3.08587 329.509 4.89975 328.784 6.22992C327.333 8.89027 317.9 53.5116 317.9 57.5021C317.9 62.9437 321.165 64.2739 335.193 64.2739C353.694 64.2739 353.09 64.9994 359.74 34.5264C365.908 6.47177 366.029 4.6579 362.401 2.11847C358.531 -0.662802 336.523 -0.662802 332.653 2.11847ZM351.034 13.3645C351.638 14.211 347.164 37.0658 344.383 47.5863C343.295 52.0605 343.053 52.1814 337.853 52.1814C334.951 52.1814 332.29 51.8186 332.049 51.214C331.323 50.1257 338.699 15.9039 340.03 13.7273C341.118 12.0343 350.066 11.6715 351.034 13.3645Z" fill="currentColor"/>
      <path d="M379.569 3.45016C376.546 6.35236 375.579 8.89178 373.039 20.1378C371.467 27.3933 369.774 35.7371 369.291 38.6393L368.444 43.8391L374.974 40.2113C381.383 36.5836 390.09 34.4069 393.355 35.6162C394.685 36.2208 394.806 37.3091 393.959 41.5415C391.541 53.0294 392.145 52.1829 385.495 52.1829H379.327L380.174 47.225C381.02 42.6298 380.899 42.388 378.723 43.5972C375.337 45.2902 357.803 61.8569 357.803 63.1871C357.803 64.6382 393.113 64.6382 396.982 63.0662C398.675 62.4615 400.731 60.4058 401.698 58.5919C403.996 54.1177 410.163 24.612 409.075 22.9191C407.987 21.2261 396.741 22.5563 389.485 25.4585C378.723 29.6909 378.602 29.6909 381.746 27.1514C383.318 25.8213 385.132 22.3144 386.099 18.9286L387.55 12.8823L393.234 12.5195C398.796 12.1568 398.917 12.1568 398.917 15.7845C398.917 17.8402 399.28 19.5332 399.764 19.5332C400.126 19.5332 403.391 17.3565 407.019 14.6962C414.033 9.37548 415 6.59421 411.01 2.60368C408.954 0.547959 407.019 0.185188 395.894 0.185188C383.802 0.185188 383.076 0.306109 379.569 3.45016Z" fill="currentColor"/>
      <path d="M422.619 2.24187C421.651 5.265 409.801 61.7369 409.801 63.188C409.801 64.881 420.2 64.5182 421.651 62.7043C422.256 61.9788 423.949 55.8116 425.4 49.2817C426.73 42.6308 428.544 36.8264 429.391 36.2218C430.237 35.7381 433.018 35.2544 435.558 35.2544C440.878 35.2544 440.878 35.2544 437.614 50.2491C436.283 56.2953 435.195 61.8579 435.195 62.7043C435.195 63.7927 437.009 64.2764 441.12 64.2764H446.925L449.585 52.1839C452.729 36.9473 452.729 35.4962 449.464 31.8685L446.683 28.9663L451.399 24.9758C455.631 21.4689 456.236 20.0178 458.171 11.1903C460.589 0.065229 460.468 -0.297549 452.608 0.428L448.013 0.790775L445.715 11.674L443.418 22.6782L436.646 25.0967C432.897 26.5478 428.665 27.9989 427.335 28.4826C425.158 29.3291 425.158 29.0872 427.698 26.9106C429.632 25.2176 431.084 21.4689 432.897 13.4879C434.107 7.44165 434.953 2.00002 434.59 1.27447C434.107 0.66985 431.446 0.18615 428.544 0.18615C424.554 0.18615 423.103 0.66985 422.619 2.24187Z" fill="currentColor"/>
    </svg>
  )
}

const operationsItems = [
  {
    title: "Tickets",
    href: "/tickets",
    icon: Ticket,
  },
  {
    title: "Scanner",
    href: "/scanner",
    icon: ScanLine,
  },
]

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const pathname = usePathname()

  async function handleLogout() {
    await signOut({ callbackUrl: "/login" })
  }

  return (
    <TooltipProvider>
      <SidebarProvider>
        <Sidebar variant="sidebar" className="border-r border-border/50">
          <SidebarHeader className="p-4 pb-6">
            <Link href="/tickets" className="flex items-center px-1">
              <SkEventsLogo className="h-6 w-auto text-foreground" />
            </Link>
          </SidebarHeader>

          <SidebarContent className="px-3">
            <SidebarGroup className="py-2">
              <SidebarGroupLabel className="px-3 mb-2 text-[11px] font-medium text-muted-foreground uppercase tracking-wider">
                Operations
              </SidebarGroupLabel>
              <SidebarGroupContent>
                <SidebarMenu className="space-y-1">
                  {operationsItems.map((item) => {
                    const isActive = pathname === item.href
                    return (
                      <SidebarMenuItem key={item.href}>
                        <Link
                          href={item.href}
                          className={`flex items-center gap-2 h-9 px-3 rounded-md text-sm transition-colors ${
                            isActive
                              ? "bg-foreground/10 text-foreground font-medium ring-1 ring-border"
                              : "text-muted-foreground hover:text-foreground"
                          }`}
                        >
                          <item.icon className="size-4" />
                          <span>{item.title}</span>
                        </Link>
                      </SidebarMenuItem>
                    )
                  })}
                </SidebarMenu>
              </SidebarGroupContent>
            </SidebarGroup>
          </SidebarContent>

          <SidebarFooter className="p-3 mt-auto">
            <Separator className="mb-3 opacity-50" />
            <SidebarMenu>
              <SidebarMenuItem>
                <button
                  onClick={handleLogout}
                  className="flex items-center gap-2 w-full h-9 px-3 rounded-md text-sm text-muted-foreground hover:text-foreground transition-colors"
                >
                  <LogOut className="size-4" />
                  <span>Abmelden</span>
                </button>
              </SidebarMenuItem>
            </SidebarMenu>
          </SidebarFooter>
        </Sidebar>

        <SidebarInset className="bg-background">
          <header className="flex h-12 shrink-0 items-center gap-2 border-b border-border/50 px-4">
            <SidebarTrigger className="-ml-1" />
            <Separator orientation="vertical" className="mr-2 h-4 opacity-50" />
            <div className="flex-1">
              <h1 className="text-sm font-medium">
                {operationsItems.find((item) => item.href === pathname)?.title ??
                  "Dashboard"}
              </h1>
            </div>
          </header>
          <main className="flex-1 overflow-auto">{children}</main>
        </SidebarInset>
      </SidebarProvider>
    </TooltipProvider>
  )
}
